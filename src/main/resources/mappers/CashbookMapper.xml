<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.softsociety.secretary.dao.CashbookDAO">

<!-- 내역 입력 -->
<insert id="insertTrans" parameterType="Transaction">
	INSERT INTO 
	        Secretary_Transaction
	        (trans_id
	        , cashbook_id
	        , user_id
	        , family_id
	        , trans_date
	        , trans_type
	        , trans_category1
	        , trans_category2
	        , trans_payee
	        , trans_memo
	        , trans_amount)
	    VALUES 
	        (Secretary_Trans_SEQ.nextval
	        , #{cashbookId}
	        , #{userId}
	        , #{familyId}
	        , TO_DATE(#{transDate}, 'YYYY-MM-DD"T"HH24:MI')
	        , #{transType}
	        , #{transCategory1}
	        , #{transCategory2}
	        , #{transPayee}
	        , #{transMemo}
	        , #{transAmount}
	        )
</insert>

<!-- 내역 전체 조회 -->
<select id="selectAllTrans" resultType="Transaction">
	SELECT 
    trans_id
    , cashbook_id
    , user_id
    , family_id
    , to_char(trans_date, 'YYYY-MM-DD') as transDate
    , to_char(trans_date, 'HH24:MI') as transTime
    , trans_type
    , trans_category1
    , trans_category2
    , trans_payee
    , trans_memo
    , trans_amount
	FROM
	    Secretary_Transaction
	ORDER BY
		trans_date desc
</select>

<!-- 해당 월 내역 수 조회 -->
<select id="selectTransCntMonth" parameterType="int" resultType="int">
	SELECT 
		COUNT(*)
	FROM
		Secretary_Transaction
	WHERE 
		EXTRACT(MONTH FROM trans_date) = #{month}
</select>

<!-- 내역 삭제 -->
<delete id="deleteTrans" parameterType="Transaction">
	DELETE FROM Secretary_Transaction
	WHERE trans_id = #{transId} AND user_id = #{userId}
</delete>

<!-- 대분류 불러오기 -->
<select id="selectAllCategory1" parameterType="String" resultType="String">
	SELECT
		DISTINCT trans_category1
	FROM
		Secretary_Transaction
	WHERE
		user_id = #{userId}
</select>

<!-- 소분류 불러오기 -->
<select id="selectAllCategory2" parameterType="String" resultType="String">
	SELECT
		DISTINCT trans_category2
	FROM
		Secretary_Transaction
	WHERE
		user_id = #{userId}
</select>
</mapper>