<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>userList</title>
<script th:src="@{/js/jquery-3.7.0.js}"></script>
<script>

$(document).ready(function () {
    userList();
    
    // 검색어 입력이 변경될 때마다 검색 수행
    document.getElementById('title').addEventListener('input', userList);
});    

function userList() {
    // 타이틀 검색에 따른 필터링
    const searchTitle = document.getElementById('title').value;
    
    $.ajax({
        url: 'userList',
        type: 'get',
        dataType: 'json',
        success: function (list) {
            let filteredList = list;
            
            // 타이틀 검색에 따른 필터링
            if (searchTitle) {
                filteredList = filteredList.filter((item) => item.userId.includes(searchTitle));
            }
            
            // 결과를 테이블에 표시
            let htmlContent = '';
            filteredList.forEach((item) => {
                htmlContent += `
                <tr>
                    <td>${item.enabled}</td>
                    <td><a href="readUser?userId=${item.userId}">${item.userId}</a></td>
                    <td>${item.userRealName}</td>
                    <td>${item.rolename}</td>
                    <td>${item.familyId}</td> 
                    <td>${item.sex}</td> 
                </tr>
                `;
            });
            $('#searchList').html(htmlContent);
        },
        error: function (e) {
            alert(JSON.stringify(e));
        },
    });
}

</script>

</head>
<body>
	<h1>[ 회원 목록 ]</h1>
        검색<input type="text" id="title" />
        <table>
            <thead>
                <tr>
                	<th>enabled</th>
                    <th>유저ID</th>
                    <th>이름</th>
                    <th>권한</th>
                    <th>familyId</th>
                    <th>성별</th>
                </tr>
            </thead>
            <tbody id="searchList"></tbody>
        </table>
       <a th:href="@{/}">Home</a> 
</body>
</html>